<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Heartline â€” Romance Messenger (Demo)</title>
<style>
  :root{
    --ink:#111827; --muted:#6b7280;
    --glass:rgba(255,255,255,.55);
    --card:rgba(255,255,255,.92);
    --pink:#ff8fb8; --vio:#8b5cf6;
  }
  *{box-sizing:border-box} html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,-apple-system,Segoe UI,Roboto}
  body{background:linear-gradient(180deg,#ffe0ec,#eef1ff);display:flex;align-items:center;justify-content:center;padding:10px}
  .phone{width:min(375px,100%);height:min(812px,calc(100vh - 20px));border-radius:28px;background:#000;border:4px solid #0b0f1a;overflow:hidden;display:flex;flex-direction:column;box-shadow:0 16px 40px rgba(0,0,0,.35)}
  .status{height:44px;display:flex;align-items:center;justify-content:space-between;padding:0 12px;background:#0b1220;color:#e5e7eb;font-weight:700}
  .screen{position:relative;flex:1;background:#fff}
  .content{position:absolute;inset:0;display:flex;flex-direction:column}
  /* START */
  .start{position:absolute;inset:0;background:url('assets/start_screen.png') center/cover no-repeat, radial-gradient(120% 90% at 50% 10%, #ffe6f2 0%, #f7f2ff 60%, #ffffff 100%);}
  .start .shade{position:absolute;inset:0;background:linear-gradient(to top, rgba(255,255,255,.92) 8%, rgba(255,255,255,0) 40%)}
  .start .box{position:absolute;left:0;right:0;bottom:32px;display:flex;flex-direction:column;align-items:center;gap:10px}
  .logo{height:56px;background:url('assets/heartline_logo.png') center/contain no-repeat;filter:drop-shadow(0 2px 10px rgba(0,0,0,.18))}
  .btn{padding:12px 26px;border:none;border-radius:22px;background:linear-gradient(90deg,#ff8fb8,#8b5cf6);color:#fff;font-weight:800;box-shadow:0 8px 20px rgba(139,92,246,.35);font-size:17px;cursor:pointer}
  /* NAME */
  .name{position:absolute;inset:0;padding:16px;display:none}
  .name .ghost{flex:1;background:url('assets/start_screen.png') center 20%/cover no-repeat;opacity:.22;border-radius:16px}
  .card{background:var(--card);border-radius:18px;padding:16px;margin-top:10px;box-shadow:0 10px 26px rgba(0,0,0,.15)}
  .row{display:flex;gap:10px;align-items:center}
  input[type=text]{flex:1;padding:12px 14px;border:2px solid #ffd1e3;border-radius:12px;font-size:16px;outline:none}
  .ok{padding:10px 16px;border:none;border-radius:12px;background:#ff8fb8;color:#fff;font-weight:800;cursor:pointer}
  /* HOME */
  .home{position:absolute;inset:0;padding:14px;display:none;background:url('assets/sakura_anime_closeup.png') center/cover no-repeat, radial-gradient(120% 90% at 50% 10%, #ffe6f2 0%, #f7f2ff 60%, #ffffff 100%)}
  .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-top:6px}
  .app{background:var(--glass);backdrop-filter:blur(6px);border-radius:18px;padding:12px;display:flex;flex-direction:column;align-items:center;gap:6px;color:#1f2937;position:relative;cursor:pointer}
  .app img{width:34px;height:34px;border-radius:10px;object-fit:cover}
  .app small{font-size:12px}
  .badge{position:absolute;top:6px;right:8px;background:#ef4444;color:#fff;border-radius:12px;padding:2px 6px;font-size:11px;font-weight:800;display:none}
  .notif{margin-top:auto;background:rgba(255,255,255,.8);border-radius:14px;padding:8px 12px;font-size:12px;color:#374151}
  /* LIST / CHAT */
  .panel{position:absolute;inset:0;background:#fff;display:none;flex-direction:column}
  .topbar{height:50px;display:flex;align-items:center;gap:10px;padding:0 12px;border-bottom:1px solid #f3f4f6}
  .back{font-weight:900;cursor:pointer}
  .list{flex:1;overflow:auto}
  .cell{display:flex;align-items:center;gap:12px;padding:12px;border-bottom:1px solid #f3f4f6;cursor:pointer}
  .avatar{width:44px;height:44px;border-radius:50%;object-fit:cover;border:2px solid #ffd1e3;background:#fff}
  .title{font-weight:800} .sub{font-size:12px;color:#6b7280}
  .chat{flex:1;overflow:auto;padding:10px;background:linear-gradient(#fde2f3,#fff)}
  .bubble{max-width:78%;padding:11px 14px;border-radius:16px;margin:6px 0;line-height:1.35}
  .them{background:#fff;border:1px solid #f0f0f0;align-self:flex-start}
  .me{background:#dbeafe;align-self:flex-end}
  .choices{padding:10px;display:flex;flex-direction:column;gap:8px}
  .choices button{padding:10px 14px;border:none;border-radius:14px;background:#ff8fb8;color:#fff;font-weight:800;cursor:pointer}
  .hidden{display:none!important}
</style>
</head>
<body>
  <div class="phone">
    <div class="status">
      <div id="clock">--:--</div>
      <small id="date">â€”</small>
      <small>92%</small>
    </div>
    <div class="screen">
      <div class="content">
        <!-- START -->
        <section id="start" class="start">
          <div class="shade"></div>
          <div class="box">
            <div class="logo"></div>
            <button class="btn" id="btnStart">Start ðŸ’¬</button>
          </div>
        </section>

        <!-- NAME -->
        <section id="name" class="name">
          <div class="logo" style="margin:6px auto 8px;height:44px"></div>
          <div class="ghost"></div>
          <div class="card">
            <div style="font-size:18px;font-weight:800;margin-bottom:10px">Enter your name</div>
            <div class="row">
              <input id="nameInput" type="text" placeholder="e.g., Kara" maxlength="16">
              <button class="ok" id="okName">OK</button>
            </div>
            <div style="color:#6b7280;font-size:12px;margin-top:6px">Your name appears in dialogues.</div>
          </div>
        </section>

        <!-- HOME -->
        <section id="home" class="home">
          <div class="grid">
            <div class="app" id="appMessages">
              <img id="icoMessages" alt="" />
              <small>Messages</small>
              <span class="badge" id="badgeMaya">1</span>
            </div>
            <div class="app"><img alt="" id="icoPhone"/><small>Phone</small></div>
            <div class="app"><img alt="" id="icoGallery"/><small>Gallery</small></div>
            <div class="app"><img alt="" id="icoClock"/><small>Clock</small></div>
            <div class="app"><img alt="" id="icoNotes"/><small>Notes</small></div>
            <div class="app"><img alt="" id="icoSettings"/><small>Settings</small></div>
          </div>
          <div class="notif" id="homeNotif">Waiting for messagesâ€¦</div>
        </section>

        <!-- INBOX -->
        <section id="inbox" class="panel">
          <div class="topbar"><span class="back" id="backToHome">â—€</span><div style="font-weight:800">Messages</div></div>
          <div class="list" id="threadList"></div>
        </section>

        <!-- CHAT -->
        <section id="chat" class="panel">
          <div class="topbar">
            <span class="back" id="backToInbox">â—€</span>
            <img class="avatar" id="chatAvatar" alt="">
            <div id="chatTitle" style="font-weight:800">Chat</div>
          </div>
          <div class="chat" id="chatBody"></div>
        </section>
      </div>
    </div>
  </div>

  <!-- AUDIO -->
  <audio id="sndNotif" preload="auto"
    src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_64a8e0e3ce.mp3?filename=notification-113724.mp3"></audio>
  <audio id="sndClick" preload="auto"
    src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_0bb7d7f2d9.mp3?filename=button-124476.mp3"></audio>
  <audio id="bgm" preload="auto" loop
    src="https://cdn.pixabay.com/download/audio/2023/01/24/audio_1f6b665fa1.mp3?filename=lofi-study-126566.mp3"></audio>

<script>
/* ---- Clock ---- */
const ck=document.getElementById('clock'), dt=document.getElementById('date');
function tick(){const d=new Date(); ck.textContent=d.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'}); dt.textContent=d.toLocaleDateString('en-GB',{weekday:'short',day:'numeric',month:'short'})}
tick(); setInterval(tick,1000);

/* ---- Assets: PNG if present, else SVG fallback ---- */
const fallbackIcon = (letter, c1, c2) =>
  'data:image/svg+xml;utf8,'+encodeURIComponent(`
  <svg xmlns="http://www.w3.org/2000/svg" width="88" height="88" viewBox="0 0 100 100">
    <defs><radialGradient id="g" cx="50%" cy="30%" r="80%"><stop offset="0%" stop-color="${c1}"/><stop offset="100%" stop-color="${c2}"/></radialGradient></defs>
    <circle cx="50" cy="50" r="48" fill="url(#g)" stroke="#fff" stroke-width="2"/>
    <text x="50" y="58" font-family="Inter,Segoe UI" font-size="40" font-weight="800" fill="#fff" text-anchor="middle">${letter}</text>
  </svg>`);

const Icons = {
  app: fallbackIcon('â¤','#ff8fb8','#8b5cf6'),
  maja: 'assets/icons/icon_maja.png',
  riven:'assets/icons/icon_riven.png',
  noah: 'assets/icons/icon_noah.png',
  victor:'assets/icons/icon_victor.png',
  mc   :'assets/icons/icon_mc.png'
};
function testImg(url){return new Promise(res=>{const i=new Image();i.onload=()=>res(true);i.onerror=()=>res(false);i.src=url;});}

/* ---- Elements ---- */
const el = (id)=>document.getElementById(id);
const S = { start:el('start'), name:el('name'), home:el('home'), inbox:el('inbox'), chat:el('chat') };
const sndNotif=el('sndNotif'), sndClick=el('sndClick'), bgm=el('bgm');
let PLAYER='You';

/* ---- Start flow ---- */
el('btnStart').onclick=()=>{sndClick.play(); S.start.style.display='none'; S.name.style.display='block';};
el('okName').onclick=()=>beginGame();

async function beginGame(){
  PLAYER = (el('nameInput').value||'You').trim();
  localStorage.setItem('playerName', PLAYER);
  S.name.style.display='none';
  S.home.style.display='block';
  try{bgm.volume=.35; bgm.play();}catch(e){}

  // set app icons (PNG if exists)
  const appImgs=[ 'icoMessages','icoPhone','icoGallery','icoClock','icoNotes','icoSettings' ];
  appImgs.forEach(id=>{ el(id).src = Icons.app; });

  // hide badge at start, then show notification after 1.5s
  el('badgeMaya').style.display='none';
  el('homeNotif').textContent='Waiting for messagesâ€¦';
  setTimeout(()=>notifyMaya(),1500);

  // wire messages app
  el('appMessages').onclick=()=>{sndClick.play(); showInbox();};
}

/* ---- Notification from Maya ---- */
function notifyMaya(){
  el('homeNotif').textContent='New message from Maya ðŸ’¬';
  el('badgeMaya').style.display='inline-block';
  try{sndNotif.play();}catch(e){}
}

/* ---- Inbox ---- */
async function showInbox(){
  S.home.style.display='none'; S.chat.style.display='none';
  S.inbox.style.display='flex';
  el('threadList').innerHTML='';

  // Maya thread
  const cell=document.createElement('div'); cell.className='cell';
  const ava=document.createElement('img'); ava.className='avatar';
  ava.alt='Maya';
  // prefer PNG, else fallback
  if(await testImg(Icons.maja)) ava.src=Icons.maja; else ava.src=fallbackIcon('M','#ffd290','#ff8fb8');
  const info=document.createElement('div');
  info.innerHTML=`<div class="title">Maya</div><div class="sub">Hey! Guess who texted me today? ðŸ‘€</div>`;
  const badge=document.createElement('span'); badge.className='badge'; badge.style.display='inline-block'; badge.textContent='1';
  cell.append(ava, info, badge);
  cell.onclick=()=>{sndClick.play(); openChat('maya');};
  el('threadList').appendChild(cell);

  // Riven appears later (after Maya chat unlock)
  el('backToHome').onclick=()=>{S.inbox.style.display='none'; S.home.style.display='block';};
}

/* ---- Simple story engine (Chapter 1 slice) ---- */
const Story = {
  maya: {
    title:'Maya',
    avatarKey:'maja',
    script: [
      { from:'Maya', text:'Hey! Guess who texted me last night? ðŸ‘€', choice:[
        { id:'m1', text:"Don't keep me in suspense!", next:1 },
        { id:'m2', text:"Please don't say Rivenâ€¦", next:1 },
        { id:'m3', text:"Not now, Maya.", next:1 },
      ]},
      { from:'Maya', text:'Riven. He texted ME instead of you. What is he even doing? ðŸ˜¤', next:2 },
      { from:'Maya', text:'Anywayâ€¦ you good to talk about him?', choice:[
        { id:'mA', text:'Maybe later.', next:3 },
        { id:'mB', text:'Yeah, tell me.', next:3 },
      ]},
      { from:'Maya', text:'Okay. Alsoâ€¦ he asked if you were still mad.', next:'UNLOCK_RIVEN' },
      { from:'Maya', text:'Text him if you want. Iâ€™ll be here.', next:null }, // end
    ]
  },
  riven: {
    title:'Riven',
    avatarKey:'riven',
    script: [
      { from:'Riven', text:'You still awake?', next:1 },
      { from:'Riven', text:'Maya said youâ€™re still in town. Do you ever think aboutâ€¦ that night?', choice:[
        { id:'r1', text:"I try not to.", next:2 },
        { id:'r2', text:"Every day.", next:2 },
        { id:'r3', text:"Delete my number.", next:2 },
      ]},
      { from:'Riven', text:'Figuresâ€¦', next:null },
    ]
  }
};

let currentChat=null, idx=0;

async function openChat(id){
  currentChat=id; idx=0;
  S.inbox.style.display='none'; S.chat.style.display='flex';

  // header
  el('chatTitle').textContent = Story[id].title;
  const ava=el('chatAvatar'), key=Story[id].avatarKey;
  const map={maja:Icons.maja,riven:Icons.riven,noah:Icons.noah,victor:Icons.victor,mc:Icons.mc};
  if(await testImg(map[key])) ava.src=map[key];
  else {
    const fall = key==='riven'?fallbackIcon('R','#5a6aa0','#202646'):fallbackIcon('M','#ffd290','#ff8fb8');
    ava.src=fall;
  }

  // body
  const body=el('chatBody'); body.innerHTML='';
  renderStep();
  el('backToInbox').onclick=()=>{S.chat.style.display='none'; showInbox();};
}

function appendBubble(text, me=false){
  const body=el('chatBody');
  const b=document.createElement('div'); b.className='bubble ' + (me?'me':'them'); b.textContent=text;
  body.appendChild(b); body.scrollTop=body.scrollHeight;
}

function renderChoices(list){
  const body=el('chatBody');
  const wrap=document.createElement('div'); wrap.className='choices';
  list.forEach(ch=>{
    const btn=document.createElement('button'); btn.textContent=ch.text;
    btn.onclick=()=>{ appendBubble( (PLAYER||'You')+': '+ch.text, true ); idx=ch.next; renderStep(); };
    wrap.appendChild(btn);
  });
  body.appendChild(wrap); body.scrollTop=body.scrollHeight;
}

function renderNext(nextIndex){
  const body=el('chatBody');
  const wrap=document.createElement('div'); wrap.className='choices';
  const btn=document.createElement('button'); btn.textContent='Next âž¤';
  btn.onclick=()=>{ idx=nextIndex; renderStep(); };
  wrap.appendChild(btn);
  body.appendChild(wrap); body.scrollTop=body.scrollHeight;
}

function clearChoices(){
  el('chatBody').querySelectorAll('.choices').forEach(n=>n.remove());
}

function renderStep(){
  clearChoices();
  const scene = Story[currentChat].script[idx];
  if(!scene){ // end chat
    const endWrap=document.createElement('div'); endWrap.className='choices';
    const back=document.createElement('button'); back.textContent='Back to inbox';
    back.onclick=()=>{ S.chat.style.display='none'; showInbox(); };
    endWrap.appendChild(back); el('chatBody').appendChild(endWrap); return;
  }

  // special: unlock Riven
  if(scene.next==='UNLOCK_RIVEN'){
    appendBubble('Maya: ' + scene.text, false);
    setTimeout(()=>unlockRiven(), 500);
    idx++; // go to next after unlock
    renderNext(idx);
    return;
  }

  // normal
  appendBubble( (Story[currentChat].title)+': '+scene.text, false );

  if(scene.choice){ renderChoices(scene.choice); }
  else if(scene.next!=null){ renderNext(scene.next); }
  else {
    // end of this chat
    const endWrap=document.createElement('div'); endWrap.className='choices';
    const back=document.createElement('button'); back.textContent='Back to inbox';
    back.onclick=()=>{ S.chat.style.display='none'; showInbox(); };
    endWrap.appendChild(back); el('chatBody').appendChild(endWrap);
  }
}

/* ---- Unlock Riven in inbox ---- */
async function unlockRiven(){
  // go back to inbox and append Riven thread
  S.chat.style.display='none'; S.inbox.style.display='flex';
  const list=el('threadList');

  const cell=document.createElement('div'); cell.className='cell';
  const ava=document.createElement('img'); ava.className='avatar'; ava.alt='Riven';
  if(await testImg(Icons.riven)) ava.src=Icons.riven; else ava.src=fallbackIcon('R','#5a6aa0','#202646');
  const info=document.createElement('div');
  info.innerHTML=`<div class="title">Riven</div><div class="sub">â€¦Are you there?</div>`;
  cell.append(ava, info);
  cell.onclick=()=>{sndClick.play(); openChat('riven');};
  list.appendChild(cell);
  try{sndNotif.play();}catch(e){}
}

/* ---- init ---- */
</script>
</body>
</html>
