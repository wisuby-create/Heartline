<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Heartline</title>
<link rel="icon" href="assets/heartline_logo.png">
<style>
  body {
    margin: 0;
    background: url('assets/sakura_anime_closeup.png') no-repeat center/cover;
    backdrop-filter: blur(5px);
    font-family: 'Poppins', sans-serif;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  #game {
    width: 360px;
    height: 640px;
    background: rgba(255,255,255,0.9);
    border-radius: 25px;
    box-shadow: 0 0 20px rgba(0,0,0,0.2);
    overflow: hidden;
    position: relative;
  }
  #chat {
    padding: 15px;
    height: 85%;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
  }
  .msg {
    margin: 6px 0;
    max-width: 80%;
    padding: 10px 14px;
    border-radius: 15px;
    line-height: 1.3em;
  }
  .msg.them {
    align-self: flex-start;
    background: #f0f0f0;
  }
  .msg.me {
    align-self: flex-end;
    background: #cde6ff;
  }
  .choices button {
    display: block;
    margin: 6px auto;
    padding: 10px 16px;
    border: none;
    border-radius: 12px;
    background: #ff91c7;
    color: white;
    font-weight: bold;
  }
  #start {
    width: 100%;
    height: 100%;
    background: url('assets/start_screen.png') no-repeat center/cover;
    display: flex;
    flex-direction: column;
    justify-content: flex-end;
    align-items: center;
  }
  #start button {
    margin-bottom: 50px;
    font-size: 20px;
    background: #ff91c7;
    color: white;
    border: none;
    border-radius: 20px;
    padding: 10px 30px;
  }
  #inputName {
    width: 90%;
    border: 2px solid #ff91c7;
    border-radius: 15px;
    padding: 8px;
    margin-top: 10px;
    font-size: 16px;
  }
</style>
</head>

<body>
<div id="game">
  <div id="start">
    <button onclick="showName()">Start üí¨</button>
  </div>
</div>

<audio id="notif" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_64a8e0e3ce.mp3?filename=notification-113724.mp3"></audio>
<audio id="music" src="https://cdn.pixabay.com/download/audio/2023/01/24/audio_1f6b665fa1.mp3?filename=lofi-study-126566.mp3" loop></audio>

<script>
let playerName = "";
let gameDiv = document.getElementById("game");
let notif = document.getElementById("notif");
let music = document.getElementById("music");

function showName(){
  gameDiv.innerHTML = `
  <div style="text-align:center; margin-top:200px;">
    <h2>Enter your name:</h2>
    <input id="inputName" placeholder="Your name...">
    <br><br>
    <button onclick="startGame()">Continue ‚û§</button>
  </div>`;
}

function startGame(){
  playerName = document.getElementById("inputName").value || "You";
  music.volume = 0.3;
  music.play();
  startChat();
}

const script = [
  {from:"Maja", text:"Hey! Guess who texted me last night? üëÄ"},
  {choices:[
    {text:"Tell me already!", next:1},
    {text:"Let me guess‚Ä¶ Riven?", next:2},
    {text:"You‚Äôre glowing, Maja üòè", next:3}
  ]},
  {from:"Maja", text:"Yeah... it was Riven. Can you believe that?"},
  {from:"Maja", text:"He asked about you, actually."},
  {from:"Maja", text:"Said he saw you around town again."},
  {choices:[
    {text:"What did you tell him?", next:4},
    {text:"I don‚Äôt want to talk about him.", next:5}
  ]},
  {from:"Maja", text:"Just that you‚Äôre back. I didn‚Äôt say more!"},
  {from:"Maja", text:"Anyway... he might text you."},
  {from:"Riven", text:"Hey. Long time no see."},
  {choices:[
    {text:"Hey...", next:6},
    {text:"What do you want, Riven?", next:7}
  ]},
  {from:"Riven", text:"Do you ever think about‚Ä¶ that night?"},
  {from:"Riven", text:"I probably deserve the silence."},
  {from:"Riven", text:"Maya said you‚Äôre still in town."},
  {from:"Noah", text:"Hi! Are you going to the coffee shop later? ‚òï"},
  {choices:[
    {text:"Maybe. Why?", next:8},
    {text:"If you‚Äôre buying, I‚Äôm coming üòÑ", next:9}
  ]},
  {from:"Victor", text:"Good evening. I sent you the documents you asked for."},
  {from:"Victor", text:"You seem... distracted lately. Everything alright?"}
];

let step = 0;
let lock = false;

function startChat(){
  gameDiv.innerHTML = `<div id="chat"></div>`;
  addMessage(script[0]);
}

function addMessage(obj){
  const chat = document.getElementById("chat");
  if(obj.from){
    notif.play();
    const bubble = document.createElement("div");
    bubble.className = "msg " + (obj.from===playerName?"me":"them");
    bubble.innerText = obj.text;
    chat.appendChild(bubble);
    chat.scrollTop = chat.scrollHeight;
    setTimeout(()=>nextLine(),1500);
  } else if(obj.choices){
    showChoices(obj.choices);
  }
}

function showChoices(list){
  const chat = document.getElementById("chat");
  const div = document.createElement("div");
  div.className = "choices";
  list.forEach(c=>{
    const b = document.createElement("button");
    b.innerText = c.text;
    b.onclick = ()=>choose(c.next, b);
    div.appendChild(b);
  });
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

function choose(next, btn){
  const chat = document.getElementById("chat");
  const div = btn.parentNode;
  div.remove();
  const bubble = document.createElement("div");
  bubble.className = "msg me";
  bubble.innerText = btn.innerText;
  chat.appendChild(bubble);
  chat.scrollTop = chat.scrollHeight;
  setTimeout(()=>nextLine(next), 1000);
}

function nextLine(customStep){
  if(lock) return;
  lock = true;
  step = customStep || step+1;
  if(step >= script.length) return;
  setTimeout(()=>{
    addMessage(script[step]);
    lock = false;
  }, 800);
}
</script>
</body>
</html>
