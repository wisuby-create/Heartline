<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>Heartline — Romance Messenger (Demo)</title>
<style>
  :root{
    --ink:#111827; --muted:#6b7280;
    --glass:rgba(255,255,255,.55);
    --card:rgba(255,255,255,.92);
    --pink:#ff8fb8; --vio:#8b5cf6;
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,-apple-system,Segoe UI,Roboto}
  body{background:linear-gradient(180deg,#ffe0ec,#eef1ff);display:flex;align-items:center;justify-content:center;padding:10px}
  .phone{width:min(375px,100%);height:min(812px,calc(100vh - 20px));border-radius:28px;background:#000;border:4px solid #0b0f1a;overflow:hidden;display:flex;flex-direction:column;box-shadow:0 16px 40px rgba(0,0,0,.35)}
  .status{height:44px;display:flex;align-items:center;justify-content:space-between;padding:0 12px;background:#0b1220;color:#e5e7eb;font-weight:700}
  .screen{position:relative;flex:1;background:#fff}
  .content{position:absolute;inset:0;display:flex;flex-direction:column}

  /* START */
  .start{position:absolute;inset:0;background:url('assets/start_screen.png') center/cover no-repeat, radial-gradient(120% 90% at 50% 10%, #ffe6f2 0%, #f7f2ff 60%, #ffffff 100%);}
  .start .shade{position:absolute;inset:0;background:linear-gradient(to top, rgba(255,255,255,.92) 8%, rgba(255,255,255,0) 40%)}
  .start .box{position:absolute;left:0;right:0;bottom:32px;display:flex;flex-direction:column;align-items:center;gap:10px}
  .logo{height:56px;background:url('assets/heartline_logo.png') center/contain no-repeat;filter:drop-shadow(0 2px 10px rgba(0,0,0,.18))}
  .btn{padding:12px 26px;border:none;border-radius:22px;background:linear-gradient(90deg,#ff8fb8,#8b5cf6);color:#fff;font-weight:800;box-shadow:0 8px 20px rgba(139,92,246,.35);font-size:17px;cursor:pointer}

  /* NAME */
  .name{position:absolute;inset:0;padding:16px;display:none}
  .name .ghost{flex:1;background:url('assets/start_screen.png') center 20%/cover no-repeat;opacity:.22;border-radius:16px}
  .card{background:var(--card);border-radius:18px;padding:16px;margin-top:10px;box-shadow:0 10px 26px rgba(0,0,0,.15)}
  .row{display:flex;gap:10px;align-items:center}
  input[type=text]{flex:1;padding:12px 14px;border:2px solid #ffd1e3;border-radius:12px;font-size:16px;outline:none}
  .ok{padding:10px 16px;border:none;border-radius:12px;background:#ff8fb8;color:#fff;font-weight:800;cursor:pointer}

  /* HOME */
  .home{position:absolute;inset:0;padding:14px;display:none;background:radial-gradient(120% 90% at 50% 10%, #ffe6f2 0%, #f7f2ff 60%, #ffffff 100%)}
  .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-top:6px}
  .app{background:var(--glass);backdrop-filter:blur(6px);border-radius:18px;padding:12px;display:flex;flex-direction:column;align-items:center;gap:6px;color:#1f2937;position:relative;cursor:pointer}
  .app img{width:34px;height:34px;border-radius:10px;object-fit:cover;background:#fff}
  .app small{font-size:12px}
  .badge{position:absolute;top:6px;right:8px;background:#ef4444;color:#fff;border-radius:12px;padding:2px 6px;font-size:11px;font-weight:800;display:none}
  .notif{margin-top:auto;background:rgba(255,255,255,.8);border-radius:14px;padding:8px 12px;font-size:12px;color:#374151}

  /* LIST / CHAT */
  .panel{position:absolute;inset:0;background:#fff;display:none;flex-direction:column}
  .topbar{height:50px;display:flex;align-items:center;gap:10px;padding:0 12px;border-bottom:1px solid #f3f4f6}
  .back{font-weight:900;cursor:pointer}
  .list{flex:1;overflow:auto}
  .cell{display:flex;align-items:center;gap:12px;padding:12px;border-bottom:1px solid #f3f4f6;cursor:pointer}
  .avatar{width:44px;height:44px;border-radius:50%;object-fit:cover;border:2px solid #ffd1e3;background:#fff}
  .title{font-weight:800} .sub{font-size:12px;color:#6b7280}
  .chat{flex:1;overflow:auto;padding:10px;background:linear-gradient(#fde2f3,#fff)}
  .bubble{max-width:78%;padding:11px 14px;border-radius:16px;margin:6px 0;line-height:1.35}
  .them{background:#fff;border:1px solid #f0f0f0;align-self:flex-start}
  .me{background:#dbeafe;align-self:flex-end}
  .choices{padding:10px;display:flex;flex-direction:column;gap:8px}
  .choices button{padding:10px 14px;border:none;border-radius:14px;background:#ff8fb8;color:#fff;font-weight:800;cursor:pointer}
  .hidden{display:none!important}
</style>
</head>
<body>
  <div class="phone">
    <div class="status">
      <div id="clock">--:--</div>
      <small id="date">—</small>
      <small>92%</small>
    </div>
    <div class="screen">
      <div class="content">
        <!-- START -->
        <section id="start" class="start">
          <div class="shade"></div>
          <div class="box">
            <div class="logo"></div>
            <button class="btn" id="btnStart">Start 💬</button>
          </div>
        </section>

        <!-- NAME -->
        <section id="name" class="name">
          <div class="logo" style="margin:6px auto 8px;height:44px"></div>
          <div class="ghost"></div>
          <div class="card">
            <div style="font-size:18px;font-weight:800;margin-bottom:10px">Enter your name</div>
            <div class="row">
              <input id="nameInput" type="text" placeholder="e.g., Kara" maxlength="16">
              <button class="ok" id="okName">OK</button>
            </div>
            <div style="color:#6b7280;font-size:12px;margin-top:6px">Your name appears in dialogues.</div>
          </div>
        </section>

        <!-- HOME -->
        <section id="home" class="home">
          <div class="grid">
            <div class="app" id="appMessages">
              <img id="icoMessages" alt=""/>
              <small>Messages</small>
              <span class="badge" id="badgeMaya">1</span>
            </div>
            <div class="app"><img id="icoPhone" alt=""/><small>Phone</small></div>
            <div class="app"><img id="icoGallery" alt=""/><small>Gallery</small></div>
            <div class="app"><img id="icoClock" alt=""/><small>Clock</small></div>
            <div class="app"><img id="icoNotes" alt=""/><small>Notes</small></div>
            <div class="app"><img id="icoSettings" alt=""/><small>Settings</small></div>
          </div>
          <div class="notif" id="homeNotif">Waiting for messages…</div>
        </section>

        <!-- INBOX -->
        <section id="inbox" class="panel">
          <div class="topbar"><span class="back" id="backToHome">◀</span><div style="font-weight:800">Messages</div></div>
          <div class="list" id="threadList"></div>
        </section>

        <!-- CHAT -->
        <section id="chat" class="panel">
          <div class="topbar">
            <span class="back" id="backToInbox">◀</span>
            <img class="avatar" id="chatAvatar" alt="">
            <div id="chatTitle" style="font-weight:800">Chat</div>
          </div>
          <div class="chat" id="chatBody"></div>
        </section>
      </div>
    </div>
  </div>

  <!-- AUDIO -->
  <audio id="sndNotif" preload="auto"
    src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_64a8e0e3ce.mp3?filename=notification-113724.mp3"></audio>
  <audio id="sndClick" preload="auto"
    src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_0bb7d7f2d9.mp3?filename=button-124476.mp3"></audio>

<script>
/* ===== Helpers ===== */
const $ = id => document.getElementById(id);
const ck=$('clock'), dt=$('date');
function tick(){const d=new Date(); ck.textContent=d.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'}); dt.textContent=d.toLocaleDateString('en-GB',{weekday:'short',day:'numeric',month:'short'})}
tick(); setInterval(tick,1000);

function testImg(url){return new Promise(res=>{const i=new Image();i.onload=()=>res(true);i.onerror=()=>res(false);i.src=url;});}
function dataSvg(svg){return 'data:image/svg+xml;utf8,'+encodeURIComponent(svg);}

/* Icons (różne, nie same serduszka) */
const SVG = {
  msg: dataSvg(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><defs><linearGradient id='g' x1='0' x2='1'><stop stop-color='#ff8fb8'/><stop offset='1' stop-color='#8b5cf6'/></linearGradient></defs><rect rx='12' ry='12' width='64' height='64' fill='url(#g)'/><path fill='#fff' d='M14 20h36v18H28l-8 6v-6H14z'/><circle cx='24' cy='29' r='2.8' fill='#ffeff6'/><circle cx='32' cy='29' r='2.8' fill='#ffeff6'/><circle cx='40' cy='29' r='2.8' fill='#ffeff6'/></svg>`),
  phone: dataSvg(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><defs><linearGradient id='g' x1='0' x2='1'><stop stop-color='#92e3a9'/><stop offset='1' stop-color='#36c4a0'/></linearGradient></defs><rect rx='12' ry='12' width='64' height='64' fill='url(#g)'/><path fill='#fff' d='M23 15l6 8-4 4a32 32 0 0 0 12 12l4-4 8 6-2 7c-1 3-4 5-7 5A36 36 0 0 1 15 25c0-3 2-6 5-7z'/></svg>`),
  gallery: dataSvg(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><defs><linearGradient id='g' x1='0' x2='1'><stop stop-color='#ffd27f'/><stop offset='1' stop-color='#ff8a5c'/></linearGradient></defs><rect rx='12' ry='12' width='64' height='64' fill='url(#g)'/><circle cx='22' cy='22' r='6' fill='#fff'/><path fill='#fff' d='M14 46l12-12 8 8 6-6 10 10z'/></svg>`),
  clock: dataSvg(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><defs><linearGradient id='g' x1='0' x2='1'><stop stop-color='#a3b8ff'/><stop offset='1' stop-color='#6b7cff'/></linearGradient></defs><rect rx='12' ry='12' width='64' height='64' fill='url(#g)'/><circle cx='32' cy='32' r='18' fill='#fff'/><path d='M32 18v14l10 6' stroke='#6b7cff' stroke-width='4' stroke-linecap='round' fill='none'/></svg>`),
  notes: dataSvg(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><defs><linearGradient id='g' x1='0' x2='1'><stop stop-color='#ffe297'/><stop offset='1' stop-color='#ffb7b2'/></linearGradient></defs><rect rx='12' ry='12' width='64' height='64' fill='url(#g)'/><rect x='16' y='16' width='32' height='32' rx='6' fill='#fff'/><path d='M22 24h20M22 30h20M22 36h14' stroke='#ff8fb8' stroke-width='3' stroke-linecap='round'/></svg>`),
  gear: dataSvg(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'><defs><linearGradient id='g' x1='0' x2='1'><stop stop-color='#d1d5db'/><stop offset='1' stop-color='#9ca3af'/></linearGradient></defs><rect rx='12' ry='12' width='64' height='64' fill='url(#g)'/><path fill='#fff' d='M32 22a10 10 0 1 0 0 20 10 10 0 0 0 0-20zm0-10l4 6 7-2 2 7 7 2-2 7 6 4-6 4 2 7-7 2-2 7-7-2-4 6-4-6-7 2-2-7-7-2 2-7-6-4 6-4-2-7 7-2 2-7 7 2z'/></svg>`)
}

/* Fallback/PNG icon paths for people (możesz podmienić plikami PNG w assets/icons) */
const Icons = {
  appMsg: SVG.msg, appPhone: SVG.phone, appGal: SVG.gallery, appClock: SVG.clock, appNotes: SVG.notes, appSet: SVG.gear,
  maja:'assets/icons/icon_maja.png',
  riven:'assets/icons/icon_riven.png',
  noah:'assets/icons/icon_noah.png',
  victor:'assets/icons/icon_victor.png',
  mc:'assets/icons/icon_mc.png'
};

/* ===== STATE (persist in localStorage) ===== */
const STORAGE_KEY='heartline_state_v1';
function loadState(){
  const d=localStorage.getItem(STORAGE_KEY);
  if(d) try{ return JSON.parse(d);}catch(e){}
  return {
    player:'You',
    unlocked:{riven:false},
    threads:[{id:'maya', title:'Maya', avatar:'maja', preview:'Hey! Guess who texted me today? 👀', unread:true}],
    transcripts:{ maya:[], riven:[] },
    pointers:{ maya:0, riven:0 }
  };
}
function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(ST)); }
let ST = loadState();

/* ===== Elements ===== */
const Sects = { start:$('start'), name:$('name'), home:$('home'), inbox:$('inbox'), chat:$('chat') };
const sndNotif=$('sndNotif'), sndClick=$('sndClick');

/* ===== Start flow ===== */
$('btnStart').onclick=()=>{sndClick.play(); Sects.start.style.display='none'; Sects.name.style.display='block';};
$('okName').onclick=()=>beginGame();

async function beginGame(){
  const v = ($('nameInput').value||'You').trim();
  ST.player = v; saveState();
  Sects.name.style.display='none';
  Sects.home.style.display='block';

  // różne ikonki
  $('icoMessages').src=Icons.appMsg; $('icoPhone').src=Icons.appPhone; $('icoGallery').src=Icons.appGal;
  $('icoClock').src=Icons.appClock; $('icoNotes').src=Icons.appNotes; $('icoSettings').src=Icons.appSet;

  // tapeta z assets (obsługujemy nazwy z/bez spacji i różne rozszerzenia)
  setWallpaper();

  // badge i powiadomienie
  $('badgeMaya').style.display = ST.threads.some(t=>t.id==='maya' && t.unread) ? 'inline-block':'none';
  $('homeNotif').textContent = ST.threads.some(t=>t.id==='maya' && t.unread) ? 'New message from Maya 💬' : 'No new messages';

  // wejście do wiadomości
  $('appMessages').onclick=()=>{sndClick.play(); showInbox();};
}

/* Tapeta — próbujemy kilka nazw, najlepiej nazwij plik: assets/sakura_closeup.jpg */
async function setWallpaper(){
  const candidates=[
    'assets/Sakura Close-up.jpg','assets/Sakura%20Close-up.jpg',
    'assets/sakura_closeup.jpg','assets/sakura_closeup.png','assets/sakura_anime_closeup.png'
  ];
  for (const p of candidates){
    /* eslint-disable no-await-in-loop */
    if(await testImg(p)){ Sects.home.style.background=`url('${p}') center/cover no-repeat`; return; }
  }
  // zostaje gradient
}

/* ===== Inbox ===== */
function showInbox(){
  Sects.home.style.display='none'; Sects.chat.style.display='none';
  Sects.inbox.style.display='flex';
  const list=$('threadList'); list.innerHTML='';
  ST.threads.forEach(async t=>{
    const cell=document.createElement('div'); cell.className='cell';
    const ava=document.createElement('img'); ava.className='avatar';
    // avatar PNG fallback
    const map={maja:Icons.maja,riven:Icons.riven,noah:Icons.noah,victor:Icons.victor,mc:Icons.mc};
    if(await testImg(map[t.avatar])) ava.src=map[t.avatar];
    else ava.src = dataSvg(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 80 80'>
      <defs><radialGradient id='g' cx='50%' cy='30%' r='80%'><stop stop-color='#ffd1e3'/><stop offset='1' stop-color='#ff8fb8'/></radialGradient></defs>
      <circle cx='40' cy='40' r='38' fill='url(#g)'/><text x='40' y='50' font-size='26' font-weight='800' text-anchor='middle' fill='#fff'>${t.title[0]}</text></svg>`);
    const info=document.createElement('div');
    info.innerHTML=`<div class="title">${t.title}</div><div class="sub">${t.preview||''}</div>`;
    cell.append(ava,info);
    if(t.unread){ const b=document.createElement('span'); b.className='badge'; b.style.display='inline-block'; b.textContent='1'; cell.appendChild(b); }
    cell.onclick=()=>{sndClick.play(); openChat(t.id);};
    list.appendChild(cell);
  });

  $('backToHome').onclick=()=>{Sects.inbox.style.display='none'; Sects.home.style.display='block';};
}

/* ===== Story scripts (Chapter 1 – slice) ===== */
const Story = {
  maya: [
    { from:'Maya', text:'Hey! Guess who texted me last night? 👀', choice:[
      { text:"Don’t keep me in suspense!", next:1 },
      { text:"Please don’t say Riven…", next:1 },
      { text:"Not now, Maya.", next:1 },
    ]},
    { from:'Maya', text:'Riven. He texted ME instead of you. What is he even doing? 😤', next:2 },
    { from:'Maya', text:'Anyway… you good to talk about him?', choice:[
      { text:'Maybe later.', next:3 },
      { text:'Yeah, tell me.', next:3 },
    ]},
    { from:'Maya', text:'Okay. Also… he asked if you were still mad.', next:'UNLOCK_RIVEN' },
    { from:'Maya', text:'Text him if you want. I’ll be here.', next:null },
  ],
  riven: [
    { from:'Riven', text:'You still awake?', next:1 },
    { from:'Riven', text:'Maya said you’re still in town. Do you ever think about… that night?', choice:[
      { text:'I try not to.', next:2 },
      { text:'Every day.', next:2 },
      { text:'Delete my number.', next:2 },
    ]},
    { from:'Riven', text:'Figures…', next:null },
  ]
};

function ensureThread(id,title,avatar){
  if(!ST.threads.find(t=>t.id===id)){
    ST.threads.push({id,title,avatar,preview:'',unread:true});
  }
}

/* ===== Chat ===== */
function openChat(id){
  Sects.inbox.style.display='none'; Sects.chat.style.display='flex';
  const title = id==='maya'?'Maya':'Riven';
  $('chatTitle').textContent=title;
  const avaMap={maya:'maja', riven:'riven'};
  setChatAvatar(avaMap[id]);

  // oznacz jako przeczytane
  const th = ST.threads.find(t=>t.id===id); if(th){ th.unread=false; }
  $('badgeMaya').style.display='none'; saveState();

  // wypełnij z historii
  const body=$('chatBody'); body.innerHTML='';
  (ST.transcripts[id]||[]).forEach(m=>appendBubble(m.text, m.me));
  // pokaż kolejną scenę lub zakończenie
  renderStep(id);
  $('backToInbox').onclick=()=>{Sects.chat.style.display='none'; showInbox();};
}

async function setChatAvatar(key){
  const el=$('chatAvatar');
  const map={maja:Icons.maja,riven:Icons.riven,noah:Icons.noah,victor:Icons.victor,mc:Icons.mc};
  if(await testImg(map[key])) el.src=map[key];
  else el.src=dataSvg(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 80 80'><defs><radialGradient id='g' cx='50%' cy='30%' r='80%'><stop stop-color='#ffd1e3'/><stop offset='1' stop-color='#ff8fb8'/></radialGradient></defs><circle cx='40' cy='40' r='38' fill='url(#g)'/></svg>`);
}

function appendBubble(text, me=false){
  const body=$('chatBody');
  const b=document.createElement('div'); b.className='bubble ' + (me?'me':'them'); b.textContent=text;
  body.appendChild(b); body.scrollTop=body.scrollHeight;
}

function renderChoices(id, list){
  const body=$('chatBody');
  const wrap=document.createElement('div'); wrap.className='choices';
  list.forEach(ch=>{
    const btn=document.createElement('button'); btn.textContent=ch.text;
    btn.onclick=()=>{
      // zapisz wybór jako wiadomość „ja”
      const msg = { text: (ST.player||'You')+': '+ch.text, me:true };
      ST.transcripts[id].push(msg); saveState();
      appendBubble(msg.text, true);
      ST.pointers[id] = ch.next; saveState();
      renderStep(id);
    };
    wrap.appendChild(btn);
  });
  body.appendChild(wrap); body.scrollTop=body.scrollHeight;
}

function renderNext(id, nextIndex){
  const body=$('chatBody');
  const wrap=document.createElement('div'); wrap.className='choices';
  const btn=document.createElement('button'); btn.textContent='Next ➤';
  btn.onclick=()=>{ ST.pointers[id]=nextIndex; saveState(); renderStep(id); };
  wrap.appendChild(btn);
  body.appendChild(wrap); body.scrollTop=body.scrollHeight;
}

function clearChoices(){ $('chatBody').querySelectorAll('.choices').forEach(n=>n.remove()); }

function renderStep(id){
  clearChoices();
  const p = ST.pointers[id] ?? 0;
  const scene = Story[id][p];
  if(!scene){
    const wrap=document.createElement('div'); wrap.className='choices';
    const back=document.createElement('button'); back.textContent='Back to inbox';
    back.onclick=()=>{Sects.chat.style.display='none'; showInbox();};
    wrap.appendChild(back); $('chatBody').appendChild(wrap); return;
  }

  // specjalny krok: odblokuj Riven
  if(scene.next==='UNLOCK_RIVEN'){
    const line = { text:`${scene.from}: ${scene.text}`, me:false };
    ST.transcripts[id].push(line); saveState(); appendBubble(line.text,false);
    // odblokowanie wątku
    ensureThread('riven','Riven','riven'); ST.unlocked.riven=true;
    const th=ST.threads.find(t=>t.id==='riven'); if(th){ th.preview='…Are you there?'; th.unread=true; }
    saveState();
    try{$('sndNotif').play();}catch(e){}
    ST.pointers[id] = (p+1); saveState();
    renderNext(id, ST.pointers[id]);
    return;
  }

  // zwykły krok
  const line = { text:`${scene.from}: ${scene.text}`, me:false };
  // unikaj duplikatów przy odświeżaniu – dodaj tylko jeśli nie ma identycznego na końcu
  const last = ST.transcripts[id][ST.transcripts[id].length-1];
  if(!last || last.text!==line.text){ ST.transcripts[id].push(line); saveState(); appendBubble(line.text,false); }

  if(scene.choice){ renderChoices(id, scene.choice); }
  else if(scene.next!=null){ renderNext(id, scene.next); }
  else {
    const wrap=document.createElement('div'); wrap.className='choices';
    const back=document.createElement('button'); back.textContent='Back to inbox';
    back.onclick=()=>{Sects.chat.style.display='none'; showInbox();};
    wrap.appendChild(back); $('chatBody').appendChild(wrap);
  }
}

/* ===== Home entry & initial notif ===== */
$('appMessages').onclick=()=>{sndClick.play(); showInbox();};
$('badgeMaya').style.display = ST.threads.some(t=>t.id==='maya' && t.unread) ? 'inline-block':'none';
$('homeNotif').textContent = ST.threads.some(t=>t.id==='maya' && t.unread) ? 'New message from Maya 💬' : 'No new messages';

/* ===== Enter game immediately if player set (ułatwia testy) ===== */
window.addEventListener('load', ()=>{
  if(ST.player && ST.player!=='You'){
    Sects.start.style.display='none'; Sects.home.style.display='block';
    $('icoMessages').src=Icons.appMsg; $('icoPhone').src=Icons.appPhone; $('icoGallery').src=Icons.appGal;
    $('icoClock').src=Icons.appClock; $('icoNotes').src=Icons.appNotes; $('icoSettings').src=Icons.appSet;
    setWallpaper();
    $('badgeMaya').style.display = ST.threads.some(t=>t.id==='maya' && t.unread) ? 'inline-block':'none';
    $('homeNotif').textContent = ST.threads.some(t=>t.id==='maya' && t.unread) ? 'New message from Maya 💬' : 'No new messages';
  }
});
</script>
</body>
</html>
